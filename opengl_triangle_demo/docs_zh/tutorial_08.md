# OpenGL ä¸‰è§’å½¢ Demo å®è·µæ•™ç¨‹ï¼šæ„å»ºä¸€ä¸ªä¼šå‘¼å¸çš„æ¸å˜ä¸‰è§’å½¢
## æ¸²æŸ“ä¸»å¾ªç¯ renderLoop()â€”â€”è®©ä¸‰è§’å½¢â€œæ´»â€èµ·æ¥ï¼

---

## 8-1 ğŸ§  æœ¬èŠ‚è¦è§£å†³çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ

ä½ å·²ç»åšäº†ï¼š

* åˆå§‹åŒ–çª—å£ï¼ˆGLFWï¼‰
* é…ç½® OpenGLï¼ˆGLADï¼‰
* åŠ è½½å¹¶ç¼–è¯‘ Shader ç¨‹åºï¼ˆcreateShaderProgramï¼‰
* é…ç½®é¡¶ç‚¹æ•°æ®ï¼ˆVAO + VBOï¼‰

ä½†å¦‚æœä½ ç°åœ¨è¿è¡Œç¨‹åºï¼Œå®ƒä¼šä¸€é—ªè€Œè¿‡ã€‚æˆ–è€…å°±ä¸€ä¸ªç©ºçª—å£å•¥ä¹Ÿæ²¡æœ‰ã€‚

ä¸ºå•¥ï¼Ÿ

å› ä¸ºä½ æ²¡æœ‰å†™â€œæ¯ä¸€å¸§â€è¦å¹²ä»€ä¹ˆï¼

---

## 8-2 ğŸŒ€ ä»€ä¹ˆæ˜¯â€œæ¸²æŸ“ä¸»å¾ªç¯â€ï¼Ÿ

OpenGL æ˜¯ä¸ªè€å®äººï¼Œ**å®ƒä¸ä¼šè‡ªåŠ¨é‡ç»˜**ã€‚ä½ ä¸å‘Šè¯‰å®ƒâ€œä¸‹ä¸€å¸§è¦å¹²å˜›â€ï¼Œå®ƒå°±é™æ­¢åœ¨é‚£é‡Œï¼Œå“ªæ€•ä½ å·²ç»è®¾ç½®äº†æ‰€æœ‰ä¸œè¥¿ã€‚

æ‰€ä»¥æˆ‘ä»¬éœ€è¦å†™ä¸€ä¸ª `while` å¾ªç¯ï¼Œåœ¨é‡Œé¢å‘Šè¯‰å®ƒï¼š

* å½“å‰å¸§è¦æ¸…ä»€ä¹ˆé¢œè‰²ï¼Ÿ
* è¦ä¸è¦æ›´æ–°æ—¶é—´ï¼Ÿ
* è¦ä¸è¦ç”»ä¸œè¥¿ï¼Ÿ
* è¦ä¸è¦å“åº”é”®ç›˜é¼ æ ‡ï¼Ÿ

è¿™ä¸ªå¾ªç¯å°±æ˜¯æ‰€è°“çš„ â€œ**ä¸»å¾ªç¯ï¼ˆmain loopï¼‰**â€ã€‚

---

## 8-3 ğŸ§  ä¸ºä»€ä¹ˆå¿…é¡»â€œæ¯ä¸€å¸§â€éƒ½é‡æ–°è®¾ç½®ï¼Ÿ

å› ä¸º GPU ä¸ä¿ç•™ä½ å‰ä¸€å¸§çš„çŠ¶æ€ï¼Œ**æ¯ä¸€å¸§éƒ½æ˜¯ä»å¤´ç”»èµ·**ã€‚ä½ ä¸ï¼š

* æ¸…å±ï¼Œå®ƒå°±å ç”»åœ¨ä¸Šé¢
* ç”¨ programï¼Œå®ƒå°±ä¸çŸ¥é“è¯¥ç”¨å“ªä¸ª
* ç»‘å®š VAOï¼Œå®ƒå°±ä¸çŸ¥é“ç”»å“ªä¸ªä¸œè¥¿
* è®¾ç½® uniformï¼Œå®ƒå°±ä¸çŸ¥é“æ—¶é—´æ˜¯å¤šå°‘

ä½ ä»¥ä¸º GPU ä¼šè®°å¾—ï¼Ÿä¸ï¼Œå®ƒè¿ä½ æ˜¯è°éƒ½ä¸è®°å¾—ã€‚

---

## 8-4 ğŸ“¦ æœ¬èŠ‚ç›®æ ‡ï¼šåœ¨main.CPPä¸­å†™ä¸€ä¸ªå« `renderLoop()` çš„å‡½æ•°

```cpp
void renderLoop(GLFWwindow* window, GLuint prog, GLuint vao, GLint u_time);
```

å®ƒçš„å·¥ä½œæµç¨‹å¤§è‡´æ˜¯ï¼š

1. æ£€æŸ¥çª—å£æ˜¯å¦å…³é—­ï¼ˆå¦‚æœç”¨æˆ·ç‚¹äº†å‰å‰ï¼Œå°±é€€å‡ºå¾ªç¯ï¼‰
2. æ¸…ç©ºå±å¹•èƒŒæ™¯
3. å‘Šè¯‰ GPU ç”¨å“ªä¸ª shader ç¨‹åº
4. æ›´æ–° `u_time` è¿™ä¸ªå…¨å±€å˜é‡ï¼Œè®©ä¸‰è§’å½¢â€œå‘¼å¸â€
5. å‘Šè¯‰ GPUï¼šç»‘å®šå“ªä¸ª VAOï¼ˆé‡Œé¢æœ‰ä¸‰è§’å½¢çš„åæ ‡æ•°æ®ï¼‰
6. ç”»å‡ºè¿™ä¸ªä¸‰è§’å½¢
7. æŠŠè¿™ä¸€å¸§ç”»çš„å†…å®¹æ˜¾ç¤ºå‡ºæ¥
8. å¤„ç†ä¸€ä¸‹é”®ç›˜é¼ æ ‡äº‹ä»¶ï¼Œå‡†å¤‡ä¸‹ä¸€å¸§

è¿™ä¸€æ•´å¥—æµç¨‹ä¼š **æ¯ä¸€å¸§é‡å¤ä¸€æ¬¡**ï¼Œä¸€ç›´åˆ°ä½ å…³é—­çª—å£ä¸ºæ­¢ã€‚

---

## 8-5 ğŸªœ æ¯ä¸€æ­¥å…·ä½“å¹²ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¿™æ ·å†™ï¼Ÿ

---

### â‘  `while (!glfwWindowShouldClose(window)) {`

è¿™æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œåªæœ‰åœ¨ç”¨æˆ·å…³é—­çª—å£æ—¶æ‰ä¼šè·³å‡ºã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼š**åªè¦çª—å£å¼€ç€ï¼ŒGPU å°±ä¸€ç›´æŒ‰ç…§ä½ çš„ä»£ç ç”»ç”»ã€ç”»ç”»ã€å†ç”»ç”»ã€‚**

---

### â‘¡ `glClearColor(...) + glClear(...)`

```cpp
glClearColor(0.12f, 0.18f, 0.15f, 1.0f);
glClear(GL_COLOR_BUFFER_BIT);
```

è¿™ä¸¤è¡Œæ„æ€æ˜¯ï¼š

> â€œæˆ‘æƒ³è¦ä¸€ä¸ªæ·±ç»¿è‰²çš„èƒŒæ™¯ï¼Œè¯·ä½ æ¸…æ‰ä¸Šä¸€å¸§çš„å†…å®¹ï¼Œç„¶åé‡æ–°æ¥è¿‡ã€‚â€

å¦‚æœä½ ä¸å†™è¿™ä¸¤è¡Œï¼Œä½ çš„ä¸‰è§’å½¢ä¼šå †åœ¨ä¸Šä¸€å¸§çš„æ®‹å½±ä¸Šï¼Œå°±åƒåœ¨ç”»å¸ƒä¸Šä¸åœåœ°ç”¨èœ¡ç¬”é‡å¤ç”»ä¸€æ ·ï¼Œæœ€ç»ˆèŠ±æˆä¸€å¨ã€‚

---

### â‘¢ `glUseProgram(prog);`

è¿™å¥å‘Šè¯‰ GPUï¼š

> â€œæˆ‘è¦ä½¿ç”¨è¿™ä¸ªå·²ç»ç¼–è¯‘å¥½çš„ Shader ç¨‹åºã€‚â€

ä½ å‰é¢ç”¨äº† `createShaderProgram(...)` æ‹¿åˆ°çš„é‚£ä¸ªç¨‹åº IDï¼Œç°åœ¨å°±æ˜¯ç”¨å®ƒæ¥â€œæŒ‡å¯¼â€è¿™ä¸€å¸§è¯¥æ€ä¹ˆç”»ã€‚

---

### â‘£ `glUniform1f(u_time, glfwGetTime());`

è¿™å¥æ˜¯ä½ ä¸‰è§’å½¢èƒ½â€œå‘¼å¸â€çš„å…³é”®ã€‚

ä½ ä¹‹å‰çš„ fragment shader å†™äº†ï¼š

```glsl
float pulse = abs(sin(u_time));
```

é‚£ `u_time` æ˜¯å“ªæ¥çš„ï¼Ÿ**ä½ å¾—æ¯ä¸€å¸§åŠ¨æ€ä¼ è¿›å»å½“å‰æ—¶é—´ã€‚**

```cpp
glfwGetTime(); // è¿”å›ä»ç¨‹åºå¯åŠ¨åˆ°ç°åœ¨ç»è¿‡çš„ç§’æ•°
```

å°±è¿™æ ·ï¼Œä½ ä¸‰è§’å½¢çš„é¢œè‰²æ¯ç§’é’Ÿä¼šå˜ä¸€æ¬¡â€”â€”åƒåœ¨è·³åŠ¨ä¸€æ ·ã€‚

---

### â‘¤ `glBindVertexArray(vao);`

ä½ ä¹‹å‰ç”¨ `setupTriangleVAO()` é…ç½®å¥½çš„ VAOï¼Œé‡Œé¢å·²ç»è®°å½•äº†ä½ ä¸‰è§’å½¢çš„åæ ‡ + é¢œè‰²æ•°æ®ã€‚

ç°åœ¨ä½ å‘Šè¯‰ GPUï¼š

> â€œæˆ‘è¦ç”»çš„å‡ ä½•ä½“æ˜¯è¿™ä¸ª VAO ç»‘å®šçš„å†…å®¹ã€‚â€

---

### â‘¥ `glDrawArrays(GL_TRIANGLES, 0, 3);`

ç»ˆäºï¼Œå¼€å§‹ç”»å›¾äº†ï¼

è¿™ä¸ªå‡½æ•°çš„æ„æ€æ˜¯ï¼š

* `GL_TRIANGLES` â†’ æˆ‘è¦ç”»çš„æ˜¯ä¸‰è§’å½¢ï¼ˆæ¯ 3 ä¸ªç‚¹ä¸ºä¸€ç»„ï¼‰
* `0` â†’ ä»ç¬¬ 0 ä¸ªé¡¶ç‚¹å¼€å§‹
* `3` â†’ æ€»å…±è¦ç”» 3 ä¸ªé¡¶ç‚¹

ä½ é‚£æ®µæ•°æ®æ˜¯ï¼š

```cpp
// x, y,  r, g, b
-0.6, -0.4, 1, 0.2, 0.2,  // é¡¶ç‚¹1
 0.6, -0.4, 0.2, 1, 0.2,  // é¡¶ç‚¹2
 0.0,  0.6, 0.2, 0.2, 1   // é¡¶ç‚¹3
```

æ‰€ä»¥æ­£å¥½ä¸€ç»„ä¸‰è§’å½¢ï¼Œç”»å‡ºæ¥ï¼

---

### â‘¦ `glfwSwapBuffers(window);`

OpenGL ä½¿ç”¨ **åŒç¼“å†²**ï¼Œä½ è¿™ä¸€å¸§ç”»å¥½äº†ï¼Œè¦ç”¨ `swap` æŠŠå®ƒæ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚

å¦åˆ™ä½ ä¼šçœ‹åˆ°â€œæ­£åœ¨ç»˜åˆ¶â€çš„ç”»é¢æŠ–åŠ¨ï¼Œåƒè€ç”µè§†æœºã€‚

---

### â‘§ `glfwPollEvents();`

è¿™ä¸€å¸§ç»“æŸäº†ï¼Œæˆ‘ä»¬è¦çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰ï¼š

* ç”¨æˆ·æŒ‰äº† ESC
* ç”¨æˆ·ç§»åŠ¨äº†é¼ æ ‡
* ç”¨æˆ·æ‹‰ä¼¸äº†çª—å£

**æ²¡æœ‰è¿™è¡Œä»£ç ï¼Œä½ çš„çª—å£ä¼šâ€œå‡æ­»â€**ï¼Œçœ‹èµ·æ¥åƒå´©äº†ä¸€æ ·ã€‚

---

## 8-6 âœ… æœ¬èŠ‚çŸ¥è¯†ç‚¹æ±‡æ€»

| æ­¥éª¤                          | åšä»€ä¹ˆ          | ä¸ºä»€ä¹ˆè¦è¿™æ ·åš      |
| --------------------------- | ------------ | ------------ |
| `glClearColor + glClear`    | æ¸…å±           | é¿å…ä¸Šä¸€å¸§æ®‹ç•™      |
| `glUseProgram`              | ä½¿ç”¨ Shader ç¨‹åº | æŒ‡å®šæ€ä¹ˆç”»        |
| `glUniform1f(u_time, time)` | æ›´æ–°æ—¶é—´         | è®©ä¸‰è§’å½¢åŠ¨èµ·æ¥      |
| `glBindVertexArray(vao)`    | åŠ è½½ä¸‰è§’å½¢æ•°æ®      | GPU è¦çŸ¥é“ç”»å“ª    |
| `glDrawArrays(...)`         | å¼€å§‹ç”»å›¾         | ç”»å‡ºä¸‰è§’å½¢        |
| `glfwSwapBuffers`           | æ˜¾ç¤ºè¿™ä¸€å¸§ç”»é¢      | GPU ç”»çš„å†…å®¹æ¨ä¸Šå±å¹• |
| `glfwPollEvents()`          | å¤„ç†äº¤äº’         | ä¿è¯çª—å£å“åº”       |

---

## 8-7 ğŸ“„ æœ€ç»ˆå®Œæ•´ä»£ç ï¼šrenderLoop()

```cpp
void renderLoop(GLFWwindow* window, GLuint prog, GLuint vao, GLint u_time) {
    while (!glfwWindowShouldClose(window)) {
        // 1. è®¾ç½®èƒŒæ™¯è‰² & æ¸…å±
        glClearColor(0.12f, 0.18f, 0.15f, 1.0f);
        glClear(GL_COLOR_BUFFER_BIT);

        // 2. ä½¿ç”¨ Shader ç¨‹åº
        glUseProgram(prog);

        // 3. æ›´æ–° uniform: u_time
        if (u_time >= 0)
            glUniform1f(u_time, static_cast<float>(glfwGetTime()));

        // 4. ç»‘å®š VAO å¹¶ç»˜åˆ¶ä¸‰è§’å½¢
        glBindVertexArray(vao);
        glDrawArrays(GL_TRIANGLES, 0, 3);

        // 5. æ˜¾ç¤º & å¤„ç†è¾“å…¥äº‹ä»¶
        glfwSwapBuffers(window);
        glfwPollEvents();
    }
}
```
